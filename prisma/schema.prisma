generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Accounts {
  id                   Int                   @id @default(autoincrement()) @map("AccountID")
  businessName         String                @map("BusinessName")
  contactPerson        String?               @map("ContactPerson")
  email                String?               @unique @map("Email")
  phone                String?               @map("Phone")
  businessType         BusinessType          @default(SESSION_BASED) @map("BusinessType")
  subscriptionPlan     String?               @map("SubscriptionPlan")
  createdAt            DateTime              @default(now()) @map("CreatedAt")
  updatedAt            DateTime              @default(now()) @updatedAt @map("UpdatedAt")
  isActive             Boolean               @default(true) @map("IsActive")
  smsEnabled           Boolean               @default(true) @map("SMSEnabled")
  reminderEnabled      Boolean               @default(true) @map("ReminderEnabled")
  reminderHours        Int                   @default(24) @map("ReminderHours")
  appointments         Appointments[]
  clients              Clients[]
  ExpenseCategories    ExpenseCategories[]
  Expenses             Expenses[]
  notificationSettings NotificationSetting[]
  notifications        Notification[]
  permissions          Permission[]
  reportTemplates      ReportTemplate[]
  reports              Report[]
  sales                Sales[]
  services             Services[]
  staff                Staff[]
  users                User[]
  Vendors              Vendors[]
  reference_sources    reference_sources[]

  @@index([smsEnabled], map: "idx_accounts_sms_enabled")
  @@map("Accounts")
}

model Appointments {
  id              Int               @id @default(autoincrement()) @map("AppointmentID")
  accountId       Int               @map("AccountID")
  customerName    String            @map("CustomerName")
  clientId        Int?              @map("ClientID")
  serviceId       Int               @map("ServiceID")
  staffId         Int               @map("StaffID")
  saleId          Int?              @map("SaleID")
  appointmentDate DateTime          @map("AppointmentDate")
  status          AppointmentStatus @default(PLANNED) @map("Status")
  notes           String?           @map("Notes")
  createdAt       DateTime          @default(now()) @map("CreatedAt")
  updatedAt       DateTime          @default(now()) @updatedAt @map("UpdatedAt")
  reminderSentAt  DateTime?         @map("ReminderSentAt")
  account         Accounts          @relation(fields: [accountId], references: [id], onDelete: Cascade)
  client          Clients?          @relation(fields: [clientId], references: [id], onDelete: Cascade)
  sale            Sales?            @relation(fields: [saleId], references: [id])
  service         Services          @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  staff           Staff             @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@map("Appointments")
}

model Clients {
  id           Int            @id @default(autoincrement()) @map("ClientID")
  accountId    Int            @map("AccountID")
  firstName    String         @map("FirstName")
  lastName     String         @map("LastName")
  phone        String?        @map("Phone")
  email        String?        @map("Email")
  isActive     Boolean        @default(true) @map("IsActive")
  createdAt    DateTime       @default(now()) @map("CreatedAt")
  updatedAt    DateTime       @default(now()) @updatedAt @map("UpdatedAt")
  appointments Appointments[]
  account      Accounts       @relation(fields: [accountId], references: [id], onDelete: Cascade)
  sales        Sales[]

  @@map("Clients")
}

model Sales {
  id                Int                @id @default(autoincrement()) @map("SaleID")
  accountId         Int                @map("AccountID")
  clientId          Int                @map("ClientID")
  serviceId         Int                @map("ServiceID")
  saleDate          DateTime           @default(now()) @map("SaleDate")
  totalAmount       Decimal            @map("TotalAmount") @db.Decimal(10, 2)
  remainingSessions Int                @map("RemainingSessions")
  isDeleted         Boolean            @default(false) @map("IsDeleted")
  createdAt         DateTime           @default(now()) @map("CreatedAt")
  updatedAt         DateTime           @default(now()) @updatedAt @map("UpdatedAt")
  notes             String?            @map("Notes")
  reference_id      Int?
  appointments      Appointments[]
  payments          Payments[]
  account           Accounts           @relation(fields: [accountId], references: [id], onDelete: Cascade)
  client            Clients            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  service           Services           @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  reference_sources reference_sources? @relation(fields: [reference_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_reference")
  sessions          Sessions[]

  @@map("Sales")
}

model Payments {
  id            Int           @id @default(autoincrement()) @map("PaymentID")
  saleId        Int           @map("SaleID")
  paymentDate   DateTime      @default(now()) @map("PaymentDate")
  amountPaid    Decimal       @map("AmountPaid") @db.Decimal(10, 2)
  paymentMethod PaymentMethod @default(CASH) @map("PaymentMethod")
  status        PaymentStatus @default(PENDING) @map("Status")
  notes         String?       @map("Notes")
  createdAt     DateTime      @default(now()) @map("CreatedAt")
  updatedAt     DateTime      @default(now()) @updatedAt @map("UpdatedAt")
  sale          Sales         @relation(fields: [saleId], references: [id], onDelete: Cascade)

  @@map("Payments")
}

model Services {
  id              Int            @id @default(autoincrement()) @map("ServiceID")
  accountId       Int            @map("AccountID")
  serviceName     String         @map("ServiceName")
  description     String?        @map("Description")
  price           Decimal        @map("Price") @db.Decimal(10, 2)
  durationMinutes Int?           @map("DurationMinutes")
  isSessionBased  Boolean        @default(false) @map("IsSessionBased")
  sessionCount    Int            @default(1) @map("SessionCount")
  isActive        Boolean        @default(true) @map("IsActive")
  createdAt       DateTime       @default(now()) @map("CreatedAt")
  updatedAt       DateTime       @default(now()) @updatedAt @map("UpdatedAt")
  appointments    Appointments[]
  sales           Sales[]
  account         Accounts       @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@unique([accountId, serviceName])
  @@map("Services")
}

model Sessions {
  id          Int           @id @default(autoincrement()) @map("SessionID")
  saleId      Int           @map("SaleID")
  staffId     Int?          @map("StaffID")
  sessionDate DateTime      @map("SessionDate")
  status      SessionStatus @default(SCHEDULED) @map("Status")
  notes       String?       @map("Notes")
  createdAt   DateTime      @default(now()) @map("CreatedAt")
  updatedAt   DateTime      @default(now()) @updatedAt @map("UpdatedAt")
  sale        Sales         @relation(fields: [saleId], references: [id], onDelete: Cascade)
  staff       Staff?        @relation(fields: [staffId], references: [id])

  @@map("Sessions")
}

model Staff {
  id               Int               @id @default(autoincrement()) @map("StaffID")
  accountId        Int               @map("AccountID")
  fullName         String            @map("FullName")
  role             String?           @map("Role")
  phone            String?           @map("Phone")
  email            String?           @map("Email")
  isActive         Boolean           @default(true) @map("IsActive")
  createdAt        DateTime          @default(now()) @map("CreatedAt")
  updatedAt        DateTime          @default(now()) @updatedAt @map("UpdatedAt")
  userId           Int?              @unique @map("UserID")
  appointments     Appointments[]
  Expenses         Expenses[]
  sessions         Sessions[]
  account          Accounts          @relation(fields: [accountId], references: [id], onDelete: Cascade)
  user             User?             @relation(fields: [userId], references: [id])
  staffPermissions StaffPermission[]
  workingHours     WorkingHours[]

  @@map("Staff")
}

model WorkingHours {
  id        Int      @id @default(autoincrement()) @map("WorkingHourID")
  staffId   Int      @map("StaffID")
  dayOfWeek Int      @map("DayOfWeek")
  startTime DateTime @map("StartTime")
  endTime   DateTime @map("EndTime")
  isWorking Boolean  @default(true) @map("IsWorking")
  createdAt DateTime @default(now()) @map("CreatedAt")
  updatedAt DateTime @default(now()) @updatedAt @map("UpdatedAt")
  staff     Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, dayOfWeek])
  @@map("WorkingHours")
}

model User {
  id                   Int                   @id @default(autoincrement())
  username             String
  email                String                @unique
  password             String
  phone                String?
  role                 UserRole              @default(EMPLOYEE)
  accountId            Int?
  createdAt            DateTime              @default(now()) @map("CreatedAt")
  updatedAt            DateTime              @default(now()) @updatedAt @map("UpdatedAt")
  notificationSettings NotificationSetting[]
  notifications        Notification[]
  reports              Report[]
  staff                Staff?
  account              Accounts?             @relation(fields: [accountId], references: [id])

  @@map("Users")
}

model Permission {
  id               Int               @id @default(autoincrement()) @map("PermissionID")
  accountId        Int               @map("AccountID")
  name             String            @map("Name")
  description      String?           @map("Description")
  resource         String            @map("Resource")
  createdAt        DateTime          @default(now()) @map("CreatedAt")
  updatedAt        DateTime          @default(now()) @updatedAt @map("UpdatedAt")
  account          Accounts          @relation(fields: [accountId], references: [id], onDelete: Cascade)
  staffPermissions StaffPermission[]

  @@unique([accountId, name, resource])
  @@map("Permissions")
}

model StaffPermission {
  id           Int        @id @default(autoincrement()) @map("StaffPermissionID")
  staffId      Int        @map("StaffID")
  permissionId Int        @map("PermissionID")
  canView      Boolean    @default(false) @map("CanView")
  canCreate    Boolean    @default(false) @map("CanCreate")
  canEdit      Boolean    @default(false) @map("CanEdit")
  canDelete    Boolean    @default(false) @map("CanDelete")
  createdAt    DateTime   @default(now()) @map("CreatedAt")
  updatedAt    DateTime   @default(now()) @updatedAt @map("UpdatedAt")
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  staff        Staff      @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, permissionId])
  @@map("StaffPermissions")
}

model Notification {
  id            Int              @id @default(autoincrement()) @map("NotificationID")
  accountId     Int              @map("AccountID")
  userId        Int?             @map("UserID")
  title         String           @map("Title")
  message       String           @map("Message")
  type          NotificationType @default(SYSTEM) @map("Type")
  isRead        Boolean          @default(false) @map("IsRead")
  createdAt     DateTime         @default(now()) @map("CreatedAt")
  updatedAt     DateTime         @default(now()) @updatedAt @map("UpdatedAt")
  referenceId   Int?             @map("ReferenceID")
  referenceType String?          @map("ReferenceType")
  account       Accounts         @relation(fields: [accountId], references: [id], onDelete: Cascade)
  user          User?            @relation(fields: [userId], references: [id])

  @@map("Notifications")
}

model NotificationSetting {
  id               Int              @id @default(autoincrement()) @map("SettingID")
  userId           Int              @map("UserID")
  accountId        Int              @map("AccountID")
  notificationType NotificationType @map("NotificationType")
  emailEnabled     Boolean          @default(true) @map("EmailEnabled")
  pushEnabled      Boolean          @default(true) @map("PushEnabled")
  smsEnabled       Boolean          @default(false) @map("SMSEnabled")
  createdAt        DateTime         @default(now()) @map("CreatedAt")
  updatedAt        DateTime         @default(now()) @updatedAt @map("UpdatedAt")
  reminderEnabled  Boolean          @default(false) @map("ReminderEnabled")
  reminderHours    Int              @default(24) @map("ReminderHours")
  account          Accounts         @relation(fields: [accountId], references: [id], onDelete: Cascade)
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, accountId, notificationType])
  @@index([reminderEnabled, reminderHours], map: "idx_notification_settings_reminder")
  @@map("NotificationSettings")
}

model Report {
  id          Int          @id @default(autoincrement()) @map("ReportID")
  accountId   Int          @map("AccountID")
  name        String       @map("Name")
  type        ReportType   @default(SALES) @map("Type")
  parameters  String?      @map("Parameters")
  createdBy   Int?         @map("CreatedBy")
  createdAt   DateTime     @default(now()) @map("CreatedAt")
  updatedAt   DateTime     @default(now()) @updatedAt @map("UpdatedAt")
  completedAt DateTime?    @map("CompletedAt")
  status      ReportStatus @default(PENDING) @map("Status")
  resultUrl   String?      @map("ResultURL")
  account     Accounts     @relation(fields: [accountId], references: [id], onDelete: Cascade)
  user        User?        @relation(fields: [createdBy], references: [id])

  @@map("Reports")
}

model ReportTemplate {
  id           Int        @id @default(autoincrement()) @map("TemplateID")
  accountId    Int?       @map("AccountID")
  name         String     @map("Name")
  description  String?    @map("Description")
  type         ReportType @map("Type")
  parameters   String?    @map("Parameters")
  query        String     @map("Query")
  outputFormat String     @default("PDF") @map("OutputFormat")
  isActive     Boolean    @default(true) @map("IsActive")
  isSystem     Boolean    @default(false) @map("IsSystem")
  createdAt    DateTime   @default(now()) @map("CreatedAt")
  updatedAt    DateTime   @default(now()) @updatedAt @map("UpdatedAt")
  account      Accounts?  @relation(fields: [accountId], references: [id])

  @@map("ReportTemplates")
}

model ExpenseCategories {
  CategoryID   Int        @id @default(autoincrement())
  AccountID    Int
  CategoryName String     @db.VarChar(100)
  Description  String?
  IsActive     Boolean?   @default(true)
  CreatedAt    DateTime?  @default(now()) @db.Timestamp(6)
  Accounts     Accounts   @relation(fields: [AccountID], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_category_account")
  Expenses     Expenses[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model Expenses {
  ExpenseID         Int               @id @default(autoincrement())
  AccountID         Int
  CategoryID        Int
  ExpenseDate       DateTime          @default(dbgenerated("CURRENT_DATE")) @db.Date
  Amount            Decimal           @db.Decimal(12, 2)
  CurrencyCode      String            @default("TRY") @db.VarChar(10)
  Description       String?
  ExpenseType       String            @db.VarChar(50)
  StaffID           Int?
  VendorID          Int?
  PaymentStatus     String            @default("pending") @db.VarChar(20)
  PaidAmount        Decimal?          @default(0.00) @db.Decimal(12, 2)
  PaymentDate       DateTime?         @db.Date
  CreatedAt         DateTime?         @default(now()) @db.Timestamp(6)
  Accounts          Accounts          @relation(fields: [AccountID], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_expense_account")
  ExpenseCategories ExpenseCategories @relation(fields: [CategoryID], references: [CategoryID], onUpdate: NoAction, map: "fk_expense_category")
  Staff             Staff?            @relation(fields: [StaffID], references: [id], onUpdate: NoAction, map: "fk_expense_staff")
  Vendors           Vendors?          @relation(fields: [VendorID], references: [VendorID], onUpdate: NoAction, map: "fk_expense_vendor")
}

model Vendors {
  VendorID      Int        @id @default(autoincrement())
  AccountID     Int
  VendorName    String     @db.VarChar(150)
  ContactPerson String?    @db.VarChar(100)
  Phone         String?    @db.VarChar(30)
  Email         String?    @db.VarChar(100)
  Address       String?
  CreatedAt     DateTime?  @default(now()) @db.Timestamp(6)
  Expenses      Expenses[]
  Accounts      Accounts   @relation(fields: [AccountID], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_vendor_account")
}

model reference_sources {
  id             Int       @id @default(autoincrement())
  reference_type String    @db.VarChar(50)
  reference_name String?   @db.VarChar(100)
  notes          String?
  accountid      Int?
  Sales          Sales[]
  Accounts       Accounts? @relation(fields: [accountid], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_reference_account")
}

enum BusinessType {
  SESSION_BASED     @map("SessionBased")
  NON_SESSION_BASED @map("NonSessionBased")
}

enum AppointmentStatus {
  PLANNED
  COMPLETED
  CANCELLED
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  TRANSFER
  OTHER
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum SessionStatus {
  SCHEDULED
  COMPLETED
  MISSED
}

enum UserRole {
  EMPLOYEE
  OWNER
  ADMIN
}

enum NotificationType {
  APPOINTMENT
  PAYMENT
  SESSION
  SYSTEM
  MARKETING
}

enum ReportType {
  SALES
  APPOINTMENTS
  SESSIONS
  CLIENTS
  STAFF
  FINANCIAL
  CUSTOM
}

enum ReportStatus {
  PENDING
  COMPLETED
  FAILED
}
